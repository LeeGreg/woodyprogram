```xml
<!--templates/hello.html-->
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
<p th:text="'hello:'+${name}" ></p>
</body>
</html>
```

## Redis

* 自定义redis工具类
  * 自动化前缀
  * 序列化及反序列化

* Jedis依赖、Fastjson依赖

* 封装工具`RedisPoolFactory.java`、`RedisConfig.java`、`KeyPrefix.java`、`BasePrefix.java`、`UserKey.java`、`RedisService.java`

  

  

  

  ![image-20190810222252947](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190810222252947.png)

  ```sql
  CREATE TABLE `miaosha_user` {
  	`id` bigint(20) NOT NULL COMENT '用户ID，手机号码',
  	`nickname` varchar(255) NOT NULL,
  	`password` varchar(32) DEFAULT NULL COMENT 'MD5(MD5(pass明文+固定salt)+salt)',
  	`salt` varchar(10) DEFAULT NULL,
  	`head` varchar(120) DEFAULT NULL COMENT '头像，云存储的ID',
  	`register_date` datetime DEFAULT NULL COMENT '注册时间',
  	`last_login_date` datetime DEFAULT NULL COMENT '上次登录时间',
  	`login_count` int(11) DEFAULT '0' COMENT '登录次数',
  	PRIMARY KEY('id')
  } ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
  ```

  ![image-20190810222343702](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190810222343702.png)

  ![image-20190810222509622](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190810222509622.png)

  * 前台 MD5 加密 login.html
  * 后台 MD5 加密 MD5Util.java

* JSP303参数检验

  * Controller方法参数前加上@Valid注解
  * Bean属性上添加相应注解，如@NotNull等
  * 自定义校验注解`IsMobile.java`
    * 照葫芦画瓢参考已有的注解，如@NotNull

* 全局异常处理器

  * `GlobalException extend RuntimeException`
  * `GlobalExceptionHandler`上添加`@ControllerAdvice`、`@ResponseBody`，类中方法上添加`@ExceptionHandler(value=Exception.class)`

* 分布式Session

* 登录统一校验

  * 登录访问`/login/to_login`接口
* `public class WebConfig extends WebMvcConfigurerAdapter`

![image-20190811080730795](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811080730795.png)

  ![image-20190811081652062](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811081652062.png)

  ![image-20190811081711977](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811081711977.png)

  ![image-20190811081855341](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811081855341.png)

  ```sql
  CREATE TABLE `goods` {
  	`id` bigint(20) NOT NULL AUTO_INCREMENT COMENT '商品ID',
  	`goods_name` varchar(16) DEFAULT NULL COMENT '商品名称',
  	`goods_title` varchar(64) DEFAULT NULL COMENT '商品标题',
  	`goods_img` varchar(64) DEFAULT NULL COMENT '商品的图片',
  	`goods_detail` longtext COMENT '商品的详情介绍',
  	`goods_price` decimal(10,2) DEFAULT '0.00' COMENT '商品单价',
  	`goods_stock` int(11) DEFAULT '0' COMENT '商品库存，-1表示没有限制',
  	PRIMARY KEY('id')
  } ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4;
  
  INSERT INTO `goods` VALUES (1, 'iphoneX', 'Apple iPhone X(1865) 64GB 银色 移动联通电信4G手机','/img/iphonex.png','最新款iPhone',8765.00, 12)
  ```

  ![image-20190811081938447](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811081938447.png)

  ```sql
  CREATE TABLE `miaosha_goods` {
  	`id` bigint(20) NOT NULL AUTO_INCREMENT COMENT '秒杀的商品表',
  	`goods_id` bigint(20) DEFAULT NULL COMENT '商品id',
  	`miaosha_price` decimal(10,2) DEFAULT '0.00' COMENT '秒杀价',
  	`stock_count` int(11) DEFAULT NULL COMENT '库存数量',
  	`start_date` datetime DEFAULT NULL COMMENT '秒杀开始时间',
  	`start_end` datetime DEFAULT NULL COMMENT '秒杀结束时间',
  	PRIMARY KEY('id')
  } ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4;
  
  INSERT INTO `miaosha_goods` VALUES(1,1,0.01,4,'2017-11-05 15:18:00','2017-11-13 14:00:18'),(2,2,0.01,9,'2017-11-12 14:00:14','2017-11-13 14:00:24');
  ```

  ![image-20190811082015738](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811082015738.png)

  ```sql
  CREATE TABLE `order_info` {
  	`id` bigint(20) NOT NULL AUTO_INCREMENT ,
  	`user_id` bigint(20) DEFAULT NULL COMENT '用户ID',
  	`goods_id` bigint(20) DEFAULT NULL COMENT '商品ID',
  	`delivery_addr_id` bigint(20) DEFAULT NULL COMENT '收获地址ID',
  	`goods_name` varchar(16) DEFAULT NULL COMENT '冗余过来的商品名称',
  	`goods_count` int(11) DEFAULT '0' COMENT '商品数量',
  	`goods_price` decimal(10,2) DEFAULT '0.00' COMENT '商品单价',
  	`goods_channel` tinyint(4) DEFAULT '0' COMENT '1pc,2android,3ios',
  	`status` tinyint(4) DEFAULT '0' COMENT '订单状态,0新建未支付，1已支付，2已发货，3已收货，4已退款，5已完成',
  	`create_date` datetime DEFAULT NULL COMMENT '订单的创建时间',
  	`pay_date` datetime DEFAULT NULL COMMENT '支付时间',
  	PRIMARY KEY('id')
  } ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8mb4;
  ```

  ![image-20190811082051835](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811082051835.png)

  ```sql
  CREATE TABLE `miaosha_order` {
  	`id` bigint(20) NOT NULL AUTO_INCREMENT,
  	`user_id` bigint(20) DEFAULT NULL COMENT '用户id',
  	`order_id` bigint(20) DEFAULT NULL COMENT '订单ID',
  	`goods_id` bigint(20) DEFAULT NULL COMENT '商品ID',
  	PRIMARY KEY('id')
  } ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4;
  ```

* 商品列表页`/to_list`
* 商品详情页`/to_detail/{goodsId}`
* 秒杀`/do_miaosha`

![image-20190811094927505](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811094927505.png)

![image-20190811094952230](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811094952230.png)

* JMeter
  * 添加线程组
  * ![image-20190811100604347](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811100604347.png)
  * ![image-20190811100651367](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811100651367.png)
  *  

![image-20190811101057078](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811101057078.png)

![image-20190811101114640](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811101114640.png)

![image-20190811101923780](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811101923780.png)

![image-20190811101849469](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811101849469.png)

![image-20190811102012728](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811102012728.png)

![image-20190811102029358](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811102029358.png)

![image-20190811102116814](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811102116814.png)

![image-20190811102216296](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811102216296.png)

* -c 100 : 100个并发；-n 100000：10万个请求
* ![image-20190811102515823](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811102515823.png)
* `redis-benchmark -t set,lpush -q -n 100000`



* ![image-20190811102827665](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811102827665.png)
* ![image-20190811103001915](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811103001915.png)
* ![image-20190811103507334](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811103507334.png)
* ![image-20190811103832727](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811103832727.png)
* 

![image-20190811104042936](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811104042936.png)

![image-20190811104435143](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811104435143.png)

![image-20190811104236989](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811104236989.png)

* Jmeter中倒入result.jtl进行查看
* `UserUtil.java`自动生成5000个token到tokens.txt中
* ![image-20190811104959594](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811104959594.png)
* ![image-20190811105037651](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811105037651.png)
* ![image-20190811105206236](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811105206236.png)
* ![image-20190811105328903](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811105328903.png)
* ![image-20190811105417061](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811105417061.png)
* ![image-20190811105506323](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811105506323.png)
* ![image-20190811105615774](/Users/dingyuanjie/Documents/study/github/woodyprogram/img/image-20190811105615774.png)



